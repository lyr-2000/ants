{"remainingRequest":"C:\\Users\\123\\Desktop\\大创\\reldomo\\ants\\src\\main\\node_modules\\thread-loader\\dist\\cjs.js!C:\\Users\\123\\Desktop\\大创\\reldomo\\ants\\src\\main\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\123\\Desktop\\大创\\reldomo\\ants\\src\\main\\node_modules\\eslint-loader\\index.js??ref--13-0!C:\\Users\\123\\Desktop\\大创\\reldomo\\ants\\src\\main\\src\\store\\modules\\chat.js","dependencies":[{"path":"C:\\Users\\123\\Desktop\\大创\\reldomo\\ants\\src\\main\\src\\store\\modules\\chat.js","mtime":1568699380355},{"path":"C:\\Users\\123\\Desktop\\大创\\reldomo\\ants\\src\\main\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\123\\Desktop\\大创\\reldomo\\ants\\src\\main\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\123\\Desktop\\大创\\reldomo\\ants\\src\\main\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\123\\Desktop\\大创\\reldomo\\ants\\src\\main\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\nvar namespaced = true;\nvar state = {\n  ws: \"\",\n  url: \"ws://127.0.0.1:8080/chat?\",\n  myId: '',\n  // 用户自己的id\n  userList: [{\n    contactor: 171543114,\n    contactorAvatar: require(\"../../assets/img/index/antsLogo.png\"),\n    contactorName: 'abc',\n    latestTime: '2019/8/10'\n  }, {\n    contactor: 171543113,\n    contactorAvatar: require(\"../../assets/img/index/antsLogo.png\"),\n    contactorName: '111',\n    latestTime: '2019/7/10'\n  }, {\n    contactor: 171543115,\n    contactorAvatar: require(\"../../assets/img/index/antsLogo.png\"),\n    contactorName: '222',\n    latestTime: '2019/6/20'\n  }, {\n    contactor: 171543116,\n    contactorAvatar: require(\"../../assets/img/index/antsLogo.png\"),\n    contactorName: '333',\n    latestTime: '2019/5/10'\n  }],\n  chooseUser: {\n    contactor: 171543114,\n    contactorAvatar: require(\"../../assets/img/index/antsLogo.png\"),\n    contactorName: 'abc',\n    latestTime: '2019/8/10'\n  },\n  // 聊天框中的信息\n  // identify false为对方消息 true为自己的消息\n  // type 1：文本信息   2：文件\n  newsList: [{\n    identify: false,\n    content: '如果没记错的话应该是在体育中心总店买的吧,才用了几次',\n    type: 1\n  }, {\n    identify: true,\n    content: '请问怎么议价，能不能再便宜一点呢~',\n    type: 1\n  }, {\n    identify: false,\n    content: '不可以',\n    type: 1\n  }, {\n    identify: false,\n    content: '好吧，可以再少一点。',\n    type: 1\n  }, {\n    identify: false,\n    content: require(\"../../assets/img/index/antsLogo.png\"),\n    type: 2\n  }]\n};\nvar getters = {\n  getUserList: function getUserList(state) {\n    return state.userList;\n  },\n  getChooseUser: function getChooseUser(state) {\n    return state.chooseUser;\n  },\n  getNewsList: function getNewsList(state) {\n    return state.newsList;\n  }\n};\nvar mutations = {\n  chooseChange: function chooseChange(state, user) {\n    state.chooseUser = user;\n  },\n  // 将信息推送到聊天记录框中\n  pushMsg: function pushMsg(state, data) {\n    state.newsList.push(data);\n  },\n  // 修改联系人列表\n  changeUserList: function changeUserList(state, contactorlist) {\n    // require图片\n    contactorlist.forEach(function (contactor) {\n      contactor.contactorAvatar = require(contactor.contactorAvatar);\n    });\n    state.userList = contactorlist;\n  },\n  // 聊天记录覆盖\n  changeList: function changeList(state, newsList) {\n    state.newsList = newsList;\n  }\n};\nvar actions = {\n  // 选择另一个用户\n  chooseChange: function chooseChange(_ref, user) {\n    var commit = _ref.commit,\n        state = _ref.state,\n        dispatch = _ref.dispatch;\n    commit(\"chooseChange\", user);\n    console.log('data: ', data);\n    var data = {\n      type: 0,\n      id: state.myId,\n      business: state.chooseUser.contactor\n    };\n    dispatch(\"onSend\", {\n      data: data,\n      file: \"\"\n    });\n  },\n  // websocket连接\n  socketInit: function socketInit(_ref2, _ref3) {\n    var state = _ref2.state,\n        dispatch = _ref2.dispatch;\n    var id = _ref3.id,\n        business = _ref3.business;\n    var url = \"\";\n    state.myId = id;\n\n    if (!business) {\n      url = \"\".concat(state.url, \"id=\").concat(id, \"&business=\").concat(business);\n    } else {\n      url = \"\".concat(state.url, \"id=\").concat(id);\n    }\n\n    if ('WebSocket' in window) {\n      state.ws = new WebSocket(url);\n      dispatch(\"onMessage\");\n    } else if ('MozWebSocket' in window) {\n      state.ws = new MozWebSocket(url);\n      dispatch(\"onMessage\");\n    } else {\n      alert('WebSocket is not supported by this browser.');\n      return;\n    }\n  },\n  // 连接后获取数据\n  onMessage: function onMessage(_ref4) {\n    var state = _ref4.state,\n        commit = _ref4.commit;\n    console.log('state: ', state);\n\n    state.ws.onmessage = function (event) {\n      console.log(\"event:\", event);\n      var data = JSON.parse(event.data);\n\n      if (data.type == 0) {\n        // 用户下线\n        console.log(\"用户下线\");\n      } else if (data.type == 1) {\n        console.log('接收信息 ', data); // 接收文本信息\n\n        var identify = false;\n\n        if (data.id == state.myId) {\n          identify = true;\n        }\n\n        commit(\"pushMsg\", {\n          content: data.msg,\n          identify: identify,\n          type: 1\n        });\n      } else if (data.type == 2) {\n        // 接收文件\n        console.log('接收文件', data);\n        var _identify = false;\n\n        if (data.id == state.myId) {\n          _identify = true;\n        }\n\n        commit(\"pushMsg\", {\n          content: data.msg,\n          identify: _identify,\n          type: 2\n        });\n      } else if (data.type == 4) {\n        // 接收历史消息\n        console.log('历史消息', data);\n        var newsList = [];\n        data.from.forEach(function (info, index) {\n          var identify = false;\n\n          if (info.id == state.myId) {\n            identify = true;\n          }\n\n          newsList[index] = {\n            content: info.information,\n            identify: identify,\n            type: 1\n          };\n        });\n        commit(\"changeList\", newsList);\n      } else if (data.type == 5) {\n        console.log('data: ', data);\n        commit('changeUserList', data.contactorlist);\n      }\n    };\n  },\n  // 连接后发送数据\n  onSend: function onSend(_ref5, _ref6) {\n    var state = _ref5.state;\n    var data = _ref6.data,\n        file = _ref6.file;\n\n    // 发送文本信息\n    if (data.type === 1 || data.type === 0) {\n      console.log('信息或者获取聊天记录 ', data);\n      data = JSON.stringify(data);\n      state.ws.send(data);\n    } // 发送文件\n\n\n    if (data.type === 2) {\n      var reader = new FileReader();\n      reader.readAsArrayBuffer(file);\n\n      reader.onload = function (e) {\n        var blob = e.target.result;\n        var fileFinish = {\n          type: 3,\n          id: data.id,\n          business: data.business\n        }; // 提示后端文件发送完毕\n\n        blob = JSON.stringify(blob);\n        fileFinish = JSON.stringify(fileFinish);\n        state.ws.send(blob);\n        state.ws.send(fileFinish);\n      };\n    }\n  }\n};\nexport default {\n  state: state,\n  getters: getters,\n  mutations: mutations,\n  actions: actions,\n  namespaced: namespaced\n};",{"version":3,"sources":["C:\\Users\\123\\Desktop\\大创\\reldomo\\ants\\src\\main\\src\\store\\modules\\chat.js"],"names":["namespaced","state","ws","url","myId","userList","contactor","contactorAvatar","require","contactorName","latestTime","chooseUser","newsList","identify","content","type","getters","getUserList","getChooseUser","getNewsList","mutations","chooseChange","user","pushMsg","data","push","changeUserList","contactorlist","forEach","changeList","actions","commit","dispatch","console","log","id","business","file","socketInit","window","WebSocket","MozWebSocket","alert","onMessage","onmessage","event","JSON","parse","msg","from","info","index","information","onSend","stringify","send","reader","FileReader","readAsArrayBuffer","onload","e","blob","target","result","fileFinish"],"mappings":"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","sourcesContent":["const namespaced = true;\r\nconst state = {\r\n    ws: \"\",\r\n    url: \"ws://127.0.0.1:8080/chat?\",\r\n    myId: '', // 用户自己的id\r\n    userList: [{\r\n        contactor: 171543114,\r\n        contactorAvatar: require(\"../../assets/img/index/antsLogo.png\"),\r\n        contactorName: 'abc',\r\n        latestTime: '2019/8/10'\r\n    }, {\r\n        contactor: 171543113,\r\n        contactorAvatar: require(\"../../assets/img/index/antsLogo.png\"),\r\n        contactorName: '111',\r\n        latestTime: '2019/7/10'\r\n    }, {\r\n        contactor: 171543115,\r\n        contactorAvatar: require(\"../../assets/img/index/antsLogo.png\"),\r\n        contactorName: '222',\r\n        latestTime: '2019/6/20'\r\n    }, {\r\n        contactor: 171543116,\r\n        contactorAvatar: require(\"../../assets/img/index/antsLogo.png\"),\r\n        contactorName: '333',\r\n        latestTime: '2019/5/10'\r\n    }],\r\n    chooseUser: {\r\n        contactor: 171543114,\r\n        contactorAvatar: require(\"../../assets/img/index/antsLogo.png\"),\r\n        contactorName: 'abc',\r\n        latestTime: '2019/8/10'\r\n    },\r\n    // 聊天框中的信息\r\n    // identify false为对方消息 true为自己的消息\r\n    // type 1：文本信息   2：文件\r\n    newsList: [{\r\n        identify: false,\r\n        content: '如果没记错的话应该是在体育中心总店买的吧,才用了几次',\r\n        type: 1\r\n    }, {\r\n        identify: true,\r\n        content: '请问怎么议价，能不能再便宜一点呢~',\r\n        type: 1\r\n    }, {\r\n        identify: false,\r\n        content: '不可以',\r\n        type: 1\r\n    }, {\r\n        identify: false,\r\n        content: '好吧，可以再少一点。',\r\n        type: 1\r\n    }, {\r\n        identify: false,\r\n        content: require(\"../../assets/img/index/antsLogo.png\"),\r\n        type: 2\r\n    }, ]\r\n}\r\nconst getters = {\r\n    getUserList(state) {\r\n        return state.userList\r\n    },\r\n    getChooseUser(state) {\r\n        return state.chooseUser\r\n    },\r\n    getNewsList(state) {\r\n        return state.newsList\r\n    }\r\n}\r\nconst mutations = {\r\n    chooseChange(state, user) {\r\n        state.chooseUser = user;\r\n    },\r\n    // 将信息推送到聊天记录框中\r\n    pushMsg(state, data) {\r\n        state.newsList.push(data);\r\n    },\r\n    // 修改联系人列表\r\n    changeUserList(state, contactorlist) {\r\n        // require图片\r\n        contactorlist.forEach((contactor) => {\r\n            contactor.contactorAvatar = require(contactor.contactorAvatar)\r\n        })\r\n        state.userList = contactorlist;\r\n    },\r\n    // 聊天记录覆盖\r\n    changeList(state, newsList) {\r\n        state.newsList = newsList\r\n    }\r\n}\r\n\r\nconst actions = {\r\n    // 选择另一个用户\r\n    chooseChange({ commit, state, dispatch }, user) {\r\n        commit(\"chooseChange\", user)\r\n        console.log('data: ', data);\r\n        let data = {\r\n            type: 0,\r\n            id: state.myId,\r\n            business: state.chooseUser.contactor,\r\n        }\r\n        dispatch(\"onSend\", { data, file: \"\" })\r\n    },\r\n    // websocket连接\r\n    socketInit({ state, dispatch }, { id, business }) {\r\n        let url = \"\";\r\n        state.myId = id;\r\n        if (!business) {\r\n            url = `${state.url}id=${id}&business=${business}`;\r\n        } else {\r\n            url = `${state.url}id=${id}`;\r\n        }\r\n        if ('WebSocket' in window) {\r\n            state.ws = new WebSocket(url);\r\n            dispatch(\"onMessage\")\r\n        } else if ('MozWebSocket' in window) {\r\n            state.ws = new MozWebSocket(url);\r\n            dispatch(\"onMessage\")\r\n        } else {\r\n            alert('WebSocket is not supported by this browser.');\r\n            return;\r\n        }\r\n    },\r\n    // 连接后获取数据\r\n    onMessage({ state, commit }) {\r\n        console.log('state: ', state);\r\n        state.ws.onmessage = function(event) {\r\n            console.log(\"event:\", event);\r\n            let data = JSON.parse(event.data);\r\n            if (data.type == 0) {\r\n                // 用户下线\r\n                console.log(\"用户下线\")\r\n            } else if (data.type == 1) {\r\n                console.log('接收信息 ', data);\r\n                // 接收文本信息\r\n                let identify = false;\r\n                if (data.id == state.myId) {\r\n                    identify = true;\r\n                }\r\n                commit(\"pushMsg\", { content: data.msg, identify: identify, type: 1 })\r\n            } else if (data.type == 2) {\r\n                // 接收文件\r\n                console.log('接收文件', data);\r\n                let identify = false;\r\n                if (data.id == state.myId) {\r\n                    identify = true;\r\n                }\r\n                commit(\"pushMsg\", { content: data.msg, identify: identify, type: 2 })\r\n            } else if (data.type == 4) {\r\n                // 接收历史消息\r\n                console.log('历史消息', data);\r\n                let newsList = [];\r\n                data.from.forEach((info, index) => {\r\n                    let identify = false;\r\n                    if (info.id == state.myId) {\r\n                        identify = true;\r\n                    }\r\n                    newsList[index] = { content: info.information, identify, type: 1 };\r\n                })\r\n                commit(\"changeList\", newsList);\r\n            } else if (data.type == 5) {\r\n                console.log('data: ', data);\r\n                commit('changeUserList', data.contactorlist)\r\n            }\r\n        }\r\n    },\r\n    // 连接后发送数据\r\n    onSend({ state }, { data, file }) {\r\n        // 发送文本信息\r\n        if (data.type === 1 || data.type === 0) {\r\n            console.log('信息或者获取聊天记录 ', data);\r\n            data = JSON.stringify(data);\r\n            state.ws.send(data)\r\n        }\r\n        // 发送文件\r\n        if (data.type === 2) {\r\n            let reader = new FileReader();\r\n            reader.readAsArrayBuffer(file)\r\n            reader.onload = function(e) {\r\n                let blob = e.target.result\r\n                let fileFinish = {\r\n                    type: 3,\r\n                    id: data.id,\r\n                    business: data.business\r\n                };\r\n                // 提示后端文件发送完毕\r\n                blob = JSON.stringify(blob);\r\n                fileFinish = JSON.stringify(fileFinish);\r\n                state.ws.send(blob)\r\n                state.ws.send(fileFinish)\r\n            }\r\n        }\r\n    },\r\n}\r\n\r\nexport default { state, getters, mutations, actions, namespaced }"]}]}